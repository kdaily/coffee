{% extends "base.html" %}

{% block title %}Coffee Roasters{% endblock %}

{% block content %}

{% load thumbnail %}

{% if roaster_list %}
<div class="hero-unit">
  <div class="row-fluid">	    
    <div class="span12 spacerTop">  
      <h2>Coffee roasters</h2>
      State: {{state}}  
      <form id="custom-search-form" class="form-search form-horizontal form-inline">
	<div class="input-append">
	  <input type="text" class="search-query" placeholder="Roaster by location search">
	  <button type="submit" class="btn"><i class="icon-search"></i></button>
	</div>
      </form>
      <form id="custom-search-form" class="form-search form-horizontal form-inline">
	<div class="input-append">
	  <input type="text" class="search-query" placeholder="Roaster name search">
	  <button type="submit" class="btn"><i class="icon-search"></i></button>
	</div>
      </form>
    </div> 
    
    {% for roaster in roaster_list %}

    {% if forloop.counter0|divisibleby:"3" %}
    <div class="row-fluid spacer">
    {% endif %}  

    <div class="span4 span4Mod">  	
      <div style="padding:4px">		
	{% thumbnail roaster.thumb "150x200" as im  %}
	<img src = "{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}" alt="{{ roaster.name }}" align="middle"> 
	{% endthumbnail %}
      </div>
      <div class="caption">
	<h3>{{ roaster.name }}</h3>
	<a href="{{ roaster.website }}" >{{ roaster.website }}</a>
	<p><i class="icon icon-map-marker"></i> {{ roaster.city }}, {{ roaster.state }}, {{ roaster.rating.votes}}</p>		
      </div>		
      
      <div class="row-fluid">
	<!-- <div class="span4"><a class="btn btn-mini" href="/roaster/{{ roaster.id }}/">See more</a></div> -->
	<div class="span4"><a class="btn btn-mini" href="{% url 'roasterdetail' roaster.id %}">Details</a></div>
	{% if user.is_authenticated %}
	
            {% if roaster in uroaster_list %}
  	        <div class="span4"><a class="btn btn-mini"><i class="icon-user icon-minus addremoveuserroaster" name="{{ roaster.id }}"></i></a></div>
	    {% else %}
	        <div class="span4"><a class="btn btn-mini"><i class="icon-user icon-plus addremoveuserroaster" name="{{ roaster.id }}"></i></a></div>
	    {% endif %}		 		
	
	{% else %}
	    <div class="span4"><a class="btn disabled btn-mini" <i class="icon-user icon-plus"></i></a></div>			
	{% endif %}
        
        <div class="span4">
	  <fieldset class="rating" name="{{ roaster.id }}">

	    
	    <input type="radio" class="auto-submit-star" id="star5-{{ roaster.id }}" name="{{ roaster.id }}" value="5" />
	    <label for="star5-{{ roaster.id }}" title="5 stars">5 stars</label>
	    
	    <input type="radio" class="auto-submit-star" id="star4-{{ roaster.id }}" name="{{ roaster.id }}" value="4" />
	    <label for="star4-{{ roaster.id }}" title="4 stars">4 stars</label>
	    
	    <input type="radio" class="auto-submit-star" id="star3-{{ roaster.id }}" name="{{ roaster.id }}" value="3" />
	    <label for="star3-{{ roaster.id }}" title="3 stars">3 stars</label>
	    
	    <input type="radio" class="auto-submit-star" id="star2-{{ roaster.id }}" name="{{ roaster.id }}" value="2" />
	    <label for="star2-{{ roaster.id }}" title="2 stars">2 stars</label>
	    
	    <input type="radio" class="auto-submit-star" id="star1-{{ roaster.id }}" name="{{ roaster.id }}" value="1" />
	    <label for="star1-{{ roaster.id }}" title="1 stars">1 star</label>
	  </fieldset>		  
	</div>
        </div>
    </div>

	      
    {% if forloop.counter|divisibleby:"3" %}
    </div>
    {% endif %}

    {% endfor %}

</div>
</div>

{% if is_paginated %}
<div class="pagination">
  <span class="step-links">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
    {% endif %}
    
    <span class="current">
      Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
    </span>
    
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}">next</a>
    {% endif %}
  </span>
	</div>

{% endif %}
{% endif %}

{% endblock %}

{% block script %}
<script type="text/javascript">
jQuery(function($){
    $('.addremoveuserroaster').click(function(){
	if ($(this).hasClass('icon-plus')){
	    $.ajax({type: "POST",
                    url: "{% url 'add_user_roaster' %}",
               	    data: {'roaster_pk': $(this).attr('name'), 'csrfmiddlewaretoken': '{{csrf_token}}'},
               	    dataType: "text",
               	    success: function(response) {},
                    error: function(rs, e) {
                        //  alert(rs.responseText);
                    }
        	   });
	    $(this).val('Added!');
	    $(this).removeClass("icon-plus");
	    $(this).addClass("icon-minus");
	} 
        else if ($(this).hasClass('icon-minus')) {
            $.ajax({type: "POST",
                    url: "{% url 'remove_user_roaster' %}",
                    data: {'roaster_pk': $(this).attr('name'), 'csrfmiddlewaretoken': '{{csrf_token}}'},
                    dataType: "text",
                    success: function(response) {},
                    error: function(rs, e) {
                        alert(rs.responseText);
                    }
            });
	    $(this).val('Removed!');
	    $(this).removeClass("icon-minus");
	    $(this).addClass("icon-plus");
	}
			
    });

    $('.auto-submit-star').click(function(){
        alert("The value selected was '" + $(this).attr('value') + "' for name '" + $(this).attr('name') + "'");

            $.ajax({type: "POST",
                    url: "{% url 'rate_user_roaster' %}",
                    data: {'roaster_pk': $(this).attr('name'), 
                           'rating': $(this).attr('value'),
                           'csrfmiddlewaretoken': '{{csrf_token}}'},
                    dataType: "text",
                    success: function(response) {},
                    error: function(rs, e) {
                        alert(rs.responseText);
                    }
            });


        // To submit the form automatically:
        //this.form.submit();

        // To submit the form via ajax:
        //$(this.form).ajaxSubmit();
    });

});

</script>

{% endblock %}
